#!/usr/bin/env perl


=pod

=head1 NAME

td-trans - Transform whitespace-delimited into TAB-delimited lines ignoring sorrounding whitespace and make duplicated header names unique.

=cut

no if ($] >= 5.018), 'warnings' => 'experimental::smartmatch';
do '/usr/lib/tool/perl5/tabdata/common.pl' or die "$@";

while(my $line = <STDIN>)
{
	chomp $line;
	$line =~ s/^\s*//g;
	$line =~ s/\s*$//g;

	if($. == 1)
	{
		# the first line considered header,
		# and the number of fields dictates (at most) how many fields are there in the rest of the stream.
		$num_of_fields = scalar split /\s+/, $line;
	}
	
	my @Fields = split /\s+/, $line, $num_of_fields;
	
	if($. == 1)
	{
		# deduplicate header names
		my @new_Fields = ();
		for my $field (@Fields)
		{
			my @other_Fields = grep {$_ ne $field} @Fields;
			my $new_field = $field;
			while($new_field ~~ @new_Fields or $new_field ~~ @other_Fields)
			{
				# increment trailing counter
				$new_field =~ s/(\d*)$/($1 or 1) + 1/e;
			}
			push @new_Fields, $new_field;
		}
		@Fields = @new_Fields;
	}
	
	print join($FS, @Fields).$RS;
}
